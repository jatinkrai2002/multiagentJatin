# docker-compose.yml
version: "3.9"
services:
  collector:
    build: .
    container_name: collector
    command: python -c "import os; os.environ['AGENT_NAME']='collector'; os.environ['PORT']='7001'; os.environ['MEMORY_FILE']='/data/memory.json'; os.environ['AUTH_TOKEN']='shared-secret'; import agent_server; agent_server.start_server()"
    environment:
      - AUTH_TOKEN=shared-secret
      - AGENT_NAME=collector
      - PORT=7001
      - MEMORY_FILE=/data/memory.json
    volumes:
      - collector_data:/data
    networks:
      - ai_net

  analyzer:
    build: .
    container_name: analyzer
    command: python -c "import os; os.environ['AGENT_NAME']='analyzer'; os.environ['PORT']='7002'; os.environ['MEMORY_FILE']='/data/memory.json'; os.environ['AUTH_TOKEN']='shared-secret'; import agent_server; agent_server.start_server()"
    environment:
      - AUTH_TOKEN=shared-secret
      - AGENT_NAME=analyzer
      - PORT=7002
      - MEMORY_FILE=/data/memory.json
    volumes:
      - analyzer_data:/data
    networks:
      - ai_net

  reporter:
    build: .
    container_name: reporter
    command: python -c "import os; os.environ['AGENT_NAME']='reporter'; os.environ['PORT']='7003'; os.environ['MEMORY_FILE']='/data/memory.json'; os.environ['AUTH_TOKEN']='shared-secret'; import agent_server; agent_server.start_server()"
    environment:
      - AUTH_TOKEN=shared-secret
      - AGENT_NAME=reporter
      - PORT=7003
      - MEMORY_FILE=/data/memory.json
    volumes:
      - reporter_data:/data
    networks:
      - ai_net

  orchestrator:
    build: .
    container_name: orchestrator
    command: python orchestrator.py
    environment:
      - AUTH_TOKEN=shared-secret
    depends_on:
      - collector
      - analyzer
      - reporter
    networks:
      - ai_net

volumes:
  collector_data:
  analyzer_data:
  reporter_data:

networks:
  ai_net:
    driver: bridge
